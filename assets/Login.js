import{u as V,r as v,a as R,o as q,c as i,b as e,d as o,g as z,t as s,e as l,w as p,f as h,h as L,i as n,j as D,k as E,l as _,F as b,m as w}from"./index.js";import{g as J,l as M}from"./auth.js";import{g as O,a as P}from"./user.js";import{C as T}from"./Captcha.js";import{_ as j}from"./_plugin-vue_export-helper.js";const A={class:"dark-tech-auth"},G={class:"auth-grid"},H={class:"branding-side"},K={class:"brand-content"},Q={class:"logo-container"},W=["src","alt"],X={key:1,class:"brand-title"},Y={class:"brand-desc"},Z={class:"features"},x={class:"feature-badge"},ee={class:"feature-badge"},ae={class:"feature-badge"},te={class:"form-side"},se={class:"glass-card form-container"},oe={class:"form-header"},ne={class:"form-options"},re={href:"#/forgot-password",class:"link-primary"},ie={class:"form-footer"},le={href:"#/register",class:"link-primary"},ce={__name:"Login",setup(ue){const{t:c}=V(),u=z(),$=v({}),y=v(!1),d=v(""),k=v(null),C=L(),r=R({email:"",password:"",remember:!0}),S=a=>{k.value=a};q(async()=>{try{const a=await J();a.data&&($.value=a.data)}catch(a){console.error("Failed to fetch guest config:",a)}});const N=async a=>{if(u.enableCaptcha){if(k.value===null)return w.error(c("auth.enterCaptcha"));if(k.value===!1)return w.error(c("auth.captchaInvalid"))}y.value=!0;try{const t=await M(a);if(t.data){localStorage.setItem("auth_token",t.data.auth_data),d.value="auth_success";try{d.value="fetching_user";const m=await O();m.data&&localStorage.setItem("user_info",JSON.stringify(m.data)),d.value="fetching_subscribe";const f=await P();f.data&&localStorage.setItem("subscribe_info",JSON.stringify(f.data))}catch(m){console.error("Pre-fetch failed:",m)}w.success(c("auth.loginSuccess")),C.push("/")}}catch(t){console.error("Login error:",t)}finally{y.value=!1}};return(a,t)=>{const m=h("a-input"),f=h("a-form-item"),I=h("a-input-password"),U=h("a-checkbox"),B=h("a-button"),F=h("a-form");return n(),i("div",A,[e("div",G,[e("div",H,[e("div",K,[e("div",Q,[t[3]||(t[3]=e("div",{class:"logo-glow"},null,-1)),o(u).logoUrl?(n(),i("img",{key:0,src:o(u).logoUrl,alt:o(u).siteName,class:"brand-logo-image"},null,8,W)):(n(),i("h1",X,s(o(u).siteName),1))]),e("p",Y,s(a.$t("auth.brandDesc")),1),e("div",Z,[e("div",x,[t[4]||(t[4]=e("div",{class:"badge-icon"},"ðŸ”’",-1)),e("span",null,s(a.$t("auth.enterpriseEncryption")),1)]),e("div",ee,[t[5]||(t[5]=e("div",{class:"badge-icon"},"ðŸŒ",-1)),e("span",null,s(a.$t("auth.globalNodes")),1)]),e("div",ae,[t[6]||(t[6]=e("div",{class:"badge-icon"},"âš¡",-1)),e("span",null,s(a.$t("auth.ultraFastConnection")),1)])])])]),e("div",te,[e("div",se,[e("div",oe,[e("h2",null,s(a.$t("auth.welcomeBack")),1),e("p",null,s(a.$t("auth.loginSubtitle")),1)]),l(F,{model:r,onFinish:N,layout:"vertical"},{default:p(()=>[l(f,{label:a.$t("auth.email"),name:"email",rules:[{required:!0,message:a.$t("validation.emailRequired")},{type:"email",message:a.$t("validation.emailInvalid")}]},{default:p(()=>[l(m,{value:r.email,"onUpdate:value":t[0]||(t[0]=g=>r.email=g),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),l(f,{label:a.$t("auth.password"),name:"password",rules:[{required:!0,message:a.$t("validation.passwordRequired")}]},{default:p(()=>[l(I,{value:r.password,"onUpdate:value":t[1]||(t[1]=g=>r.password=g),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),o(u).enableCaptcha?(n(),D(T,{key:0,onVerify:S})):E("",!0),e("div",ne,[l(U,{checked:r.remember,"onUpdate:checked":t[2]||(t[2]=g=>r.remember=g)},{default:p(()=>[_(s(a.$t("auth.rememberMe")),1)]),_:1},8,["checked"]),e("a",re,s(a.$t("auth.forgotPassword")),1)]),l(B,{type:"primary","html-type":"submit",loading:y.value,block:"",size:"large"},{default:p(()=>[d.value==="auth_success"?(n(),i(b,{key:0},[_(s(o(c)("auth.authenticating")),1)],64)):d.value==="fetching_user"?(n(),i(b,{key:1},[_(s(o(c)("auth.fetchingUser")),1)],64)):d.value==="fetching_subscribe"?(n(),i(b,{key:2},[_(s(o(c)("auth.fetchingSubscribe")),1)],64)):(n(),i(b,{key:3},[_(s(a.$t("auth.loginButton")),1)],64))]),_:1},8,["loading"])]),_:1},8,["model"]),e("div",ie,[e("span",null,s(a.$t("auth.noAccount")),1),e("a",le,s(a.$t("auth.registerNow")),1)])])])])])}}},pe=j(ce,[["__scopeId","data-v-cc92dd2f"]]);export{pe as default};
